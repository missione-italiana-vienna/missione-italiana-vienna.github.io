<div class = "row">
  <div class = "col">
    <div class = "section_title_container">
      <div class = "section_image">
        <img src = "https://mcivienna.org/images/common_images/church_1.png" alt = "">
      </div>
      <div class = "section_title"><h2>Dirette streaming</h2></div>
      <div class = "section_subtitle">
        <div style = "display: inline-block;">
          &ldquo; Amerai il Signore Dio tuo con tutto il cuore, con tutta la tua anima e con tutta la tua mente. &rdquo;
          <div style = "display: inline-block; font-family: serif; font-size: 80%;">(Mt 22, 37)</div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class = "row ministries_row">

  <!-- Contact Info Content -->
  <div class = "col-lg-12 d-flex flex-column align-items-start justify-content-end">
    <div class = "row">
      
      <div class = "col-lg-12 contact_info_col">
        
        <br><br>

        Qui sotto troverete man mano le dirette video registrate in passato. 
        I video registrati negli ultimi giorni sono invece disponibili a 
        <a href = "https://mcivienna.org/#!/streaming/" class = "normal_link">questo link</a>.
        
        <br><br>

        <div id = "channel-container">
          <!-- this is the container of all the videos, added by the script below -->
        </div>

        Potete trovare i video precedenti a 
        <a target = _blank rel = "noopener" class = "normal_link" 
        href = "https://www.youtube.com/channel/UCKAeLh4BIb8bTVnWn4OsqCg/videos">questo link</a>.
        
        <br>

      </div>

        
    </div>
  </div>
</div>


  <script>
    // All the code below has been heavily modified from 
    //  https://codegena.com/auto-embed-latest-video-youtube-channel/
    
    var reqURL = "https://api.rss2json.com/v1/api.json?rss_url=" + encodeURIComponent("https://www.youtube.com/feeds/videos.xml?channel_id=");

    // The API above returns a JSON similar to the one in the next lines

    // {"status":"ok","feed":{"url":"https://www.youtube.com/feeds/videos.xml?channel_id=UCKAeLh4BIb8bTVnWn4OsqCg","title":"Missione Italiana Cattolica a Vienna","link":"https://www.youtube.com/channel/UCKAeLh4BIb8bTVnWn4OsqCg","author":"Missione Italiana Cattolica a Vienna","description":"","image":""},"items":[.....]}
    
    // NOTE: the field "items" is the one we are interested in. It will contain a list of objects, each with the following structure:

    // {"title":"....","pubDate":"....","link":"....","guid":"....","author":"....", "thumbnail":"....","description":"....","content":"....","enclosure":{"link":"....","type":"....","thumbnail":"...."},"categories":[]}

    // For each such object, for the current application we are only interested in the field "link"
    // Such field will be added to the corresponding <iframe>, so that we can load the corresponding video

    // Complete example of the structure of the response of the API (actually, this is what we are loading for the current webpage, since we only load videos from the youtube webpage of Missione Cattolica Italiana a Vienna):
    // see the following link:
    // https://api.rss2json.com/v1/api.json?rss_url=https%3A%2F%2Fwww.youtube.com%2Ffeeds%2Fvideos.xml%3Fchannel_id%3DUCBJycsmduvYEL83R_U4JriQ


    // insert in the DOM a <div> containing an <iframe> with src given by the parameter my_source
    function prepareFrame(my_source, my_title) {
      console.log("creating frame with link: " + my_source + " and title: " + my_title);

      // The code below selects the unique <div> with id = "channel-container" (already in the source of the HTML, hence in the orignal DOM). To this document we will append below:
      // - a <div class = "video-title"> containing the title of the video
      // - a <div class = "video-container"> containing the <iframe> containing the video
      var channel_container = document.getElementById("channel-container");

      if (typeof my_title !== "undefined" && my_title !== "") {
        // The code below creates a <div> with the title of the current video
        var video_title = document.createElement("div");
        video_title.setAttribute("class","video-title");
        video_title.innerHTML = my_title;
        // we append this <div> to the channel container
        channel_container.appendChild(video_title);
      }

      // The code below creates an iframe as follows:
      //<iframe src = "...." frameborder = "0" allow = "accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
      // where src is defined as in the lines below
      var ifrm = document.createElement("iframe");
      id = my_source.substr(my_source.indexOf("=") + 1);  
      ifrm.setAttribute("src","https://www.youtube-nocookie.com/embed/"+id + "?controls=1&autoplay=0");
      ifrm.setAttribute("frameborder","0");
      ifrm.setAttribute("allow","accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture");
      ifrm.setAttribute("allowfullscreen","");

      // The code below creates a <div> having a class "video-container", and appends the previous iframe to that object
      var video_container = document.createElement("div");
      video_container.setAttribute("class","video-container");
      video_container.appendChild(ifrm);        

      // The code below appends the video container to the channel container
      channel_container.appendChild(video_container);
    }

    // Gets the list of all videoIDs of a given channel (up to a fixed maximum)
    function getVideoIDs(cid_youtube_channel, max_length, link_last_stream, title_last_stream) {
      var list_videos = [];
      var i;

      if (typeof link_last_stream !== "undefined" && link_last_stream !== "") {
        list_videos.push({
          "link": link_last_stream,
          "title": title_last_stream // this can possibly be undefined. This is not a problem since the function prepareFrame() can take care of that
        });
      }

      $.getJSON( reqURL + cid_youtube_channel,
        function(data) {
          for (var i = max_length; i < data.items.length; i++) {
            var link = data.items[i].link;
            var title = data.items[i].title;
            if (link != link_last_stream) {
               list_videos.push({
                "link": link,
                "title": title
              });
             }
          }

          for (i = 0; i < list_videos.length; i++) {
            prepareFrame(list_videos[i].link, list_videos[i].title);
          }
        }
      );
    }

    // channel id of the Missione Cattolica Italiana a Vienna on youtube
    var cid_youtube_channel = "UCKAeLh4BIb8bTVnWn4OsqCg"; 
    
    // this is the same parameter of the main page (https://mcivienna.org/streaming/)
    var max_length = 7;
    // it means that the first 7 videos are in the main page (in order to speed up the
    // loading of that page), all the rest is listed in the current page.
    // If we modify the parameter in the main page, we have to modify the same parameter also here.

    // link for the streaming of the current day: normally the youtube API that we use
    // is not updated in real time, so for the first few hours it does not contain the
    // link of the last stream. Hence we need sometimes to insert it manually

    var link_last_stream = "";

    getVideoIDs(cid_youtube_channel, max_length, link_last_stream);

  </script>

</body>
</html>